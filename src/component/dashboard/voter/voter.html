<!doctype html>
<!--
  - Author: Kathir E.
  - Voter Dashboard - Voting Portal
-->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>Voter Dashboard - Voting Portal</title>
 
</head>
<body>

  <!-- Mobile Menu Toggle -->
  <button class="mobile-menu-toggle" onclick="toggleSidebar()">
    <span>‚ò∞</span>
  </button>

  <div class="voter-layout">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <div class="logo-icon">üó≥Ô∏è</div>
          <span>VotePortal</span>
        </div>
      </div>

      <!-- User Profile -->
      <div class="user-profile">
        <div class="user-avatar">üë§</div>
        <div class="user-name">John Doe</div>
        <div class="user-id">Voter ID: V2025-001234</div>
      </div>

      <nav class="nav-section">
        <div class="nav-title">Dashboard</div>
        <a href="#overview" class="nav-item active" onclick="showSection('overview')">
          <span class="nav-icon">üìä</span>
          <span>Overview</span>
        </a>
      </nav>

      <nav class="nav-section">
        <div class="nav-title">Actions</div>
        <a href="#profile" class="nav-item" onclick="showSection('profile')">
          <span class="nav-icon">üë§</span>
          <span>My Profile</span>
        </a>
        <a href="#candidates" class="nav-item" onclick="showSection('candidates')">
          <span class="nav-icon">üë•</span>
          <span>View Candidates</span>
        </a>
        <a href="#vote" class="nav-item" onclick="showSection('vote')">
          <span class="nav-icon">üó≥Ô∏è</span>
          <span>Cast Vote</span>
        </a>
        <a href="#results" class="nav-item" onclick="showSection('results')">
          <span class="nav-icon">üìà</span>
          <span>Vote Results</span>
        </a>
        <a href="#update" class="nav-item" onclick="showSection('update')">
          <span class="nav-icon">‚úèÔ∏è</span>
          <span>Update Profile</span>
        </a>
      </nav>

      <nav class="nav-section">
        <div class="nav-title">Account</div>
        <a href="#settings" class="nav-item">
          <span class="nav-icon">‚öôÔ∏è</span>
          <span>Settings</span>
        </a>
        <a href="login.html" class="nav-item">
          <span class="nav-icon">üö™</span>
          <span>Logout</span>
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      
      <!-- Overview Section -->
      <div id="overview-section" class="content-section">
        <div class="page-header">
          <div class="page-title-section">
            <h1 class="page-title">Welcome Back, John!</h1>
            <p class="page-subtitle">Your voting dashboard is ready</p>
          </div>
          <div class="header-actions">
            <button class="btn btn-primary">
              <span>üó≥Ô∏è</span> Quick Vote
            </button>
          </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Active Elections</div>
            <div class="stat-value">3</div>
            <div class="stat-trend">‚Üó 1 new this week</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Votes Cast</div>
            <div class="stat-value">2</div>
            <div class="stat-trend">‚úì Verified</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Pending Elections</div>
            <div class="stat-value">1</div>
            <div class="stat-trend">‚è∞ Ends in 2 days</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Account Status</div>
            <div class="stat-value">
              <span class="badge badge-success">Active</span>
            </div>
            <div class="stat-trend">‚úì Verified Voter</div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">
              <span class="section-icon">‚ö°</span>
              Quick Actions
            </h2>
          </div>

          <div class="action-grid">
            <div class="action-card" onclick="showSection('profile')">
              <div class="action-card-header">
                <div class="action-icon profile">üë§</div>
                <div>
                  <div class="action-title">View Profile</div>
                  <div class="action-description">See your voter details</div>
                </div>
              </div>
            </div>

            <div class="action-card" onclick="showSection('candidates')">
              <div class="action-card-header">
                <div class="action-icon candidates">üë•</div>
                <div>
                  <div class="action-title">View Candidates</div>
                  <div class="action-description">Browse all candidates</div>
                </div>
              </div>
            </div>

            <div class="action-card" onclick="showSection('vote')">
              <div class="action-card-header">
                <div class="action-icon vote">üó≥Ô∏è</div>
                <div>
                  <div class="action-title">Cast Vote</div>
                  <div class="action-description">Participate in elections</div>
                </div>
              </div>
            </div>

            <div class="action-card" onclick="showSection('results')">
              <div class="action-card-header">
                <div class="action-icon results">üìà</div>
                <div>
                  <div class="action-title">View Results</div>
                  <div class="action-description">Check vote counts</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Profile Section -->
      <div id="profile-section" class="content-section hidden">
        <div class="page-header">
          <div class="page-title-section">
            <h1 class="page-title">My Profile</h1>
            <p class="page-subtitle">View your voter details</p>
          </div>
        </div>

        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">
              <span class="section-icon">üë§</span>
              Voter Details
            </h2>
          </div>

          <div class="input-form">
            <div class="input-group">
              <label class="input-label">Voter ID</label>
              <input type="text" class="input-field" id="get-voter-id" placeholder="Enter your Voter ID (e.g., V2025-001234)">
            </div>

            <div class="btn-group">
              <button class="btn btn-primary" onclick="getVoterDetails()">
                <span>üîç</span> Get My Details
              </button>
            </div>
          </div>

          <!-- Voter Details Display -->
          <div id="voter-details-container"></div>
        </div>
      </div>

      <!-- Candidates Section -->
      <div id="candidates-section" class="content-section hidden">
        <div class="page-header">
          <div class="page-title-section">
            <h1 class="page-title">Candidates</h1>
            <p class="page-subtitle">View all registered candidates</p>
          </div>
          <div class="header-actions">
            <button class="btn btn-primary" onclick="getAllCandidates()">
              <span>üîÑ</span> Refresh List
            </button>
          </div>
        </div>

        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">
              <span class="section-icon">üë•</span>
              All Candidates
            </h2>
          </div>

          <!-- Candidates Grid -->
          <div id="candidates-container" class="candidates-grid">
            <!-- Candidates will be loaded here -->
          </div>
        </div>
      </div>

      <!-- Vote Section -->
      <div id="vote-section" class="content-section hidden">
        <div class="page-header">
          <div class="page-title-section">
            <h1 class="page-title">Cast Your Vote</h1>
            <p class="page-subtitle">Make your voice heard</p>
          </div>
        </div>

        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">
              <span class="section-icon">üó≥Ô∏è</span>
              Vote Now
            </h2>
          </div>

          <div class="alert alert-info">
            <span>‚ÑπÔ∏è</span>
            <span>Your vote is anonymous and cannot be changed once submitted.</span>
          </div>

          <div class="input-form">
            <div class="input-group">
              <label class="input-label">Contract Address</label>
              <input type="text" class="input-field" id="vote-contract" placeholder="Enter election contract address">
            </div>

            <div class="input-group">
              <label class="input-label">Select Candidate</label>
              <select class="input-field" id="vote-candidate">
                <option value="">Choose a candidate...</option>
                <option value="C001">Alice Johnson - Democratic Party</option>
                <option value="C002">Bob Smith - Republican Party</option>
                <option value="C003">Carol Williams - Independent</option>
              </select>
            </div>

            <div class="input-group">
              <label class="input-label">Confirm Your Choice</label>
              <input type="text" class="input-field" id="vote-confirm" placeholder="Type candidate ID to confirm (e.g., C001)">
            </div>

            <div class="btn-group">
              <button class="btn btn-success" onclick="castVote()">
                <span>‚úì</span> Submit Vote
              </button>
              <button class="btn btn-secondary" onclick="clearVoteForm()">
                <span>‚úó</span> Cancel
              </button>
            </div>
          </div>

          <div id="vote-result-container"></div>
        </div>
      </div>

      <!-- Results Section -->
      <div id="results-section" class="content-section hidden">
        <div class="page-header">
          <div class="page-title-section">
            <h1 class="page-title">Vote Results</h1>
            <p class="page-subtitle">View election outcomes</p>
          </div>
        </div>

        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">
              <span class="section-icon">üìà</span>
              Get Vote Results
            </h2>
          </div>

          <div class="input-form">
            <div class="input-group">
              <label class="input-label">Contract Address</label>
              <input type="text" class="input-field" id="results-contract" placeholder="Enter election contract address">
            </div>

            <div class="btn-group">
              <button class="btn btn-primary" onclick="getVoteResults()">
                <span>üìä</span> Get Results
              </button>
            </div>
          </div>

          <!-- Results Display -->
          <div id="results-container"></div>
        </div>
      </div>

      <!-- Update Profile Section -->
      <div id="update-section" class="content-section hidden">
        <div class="page-header">
          <div class="page-title-section">
            <h1 class="page-title">Update Profile</h1>
            <p class="page-subtitle">Modify your voter information</p>
          </div>
        </div>

        <div class="section-card">
          <div class="section-header">
            <h2 class="section-title">
              <span class="section-icon">‚úèÔ∏è</span>
              Update Your Details
            </h2>
          </div>

          <div class="alert alert-warning">
            <span>‚ö†Ô∏è</span>
            <span>Please ensure all information is accurate. Changes may require re-verification.</span>
          </div>

          <div class="input-form">
            <div class="input-group">
              <label class="input-label">Voter ID (Cannot be changed)</label>
              <input type="text" class="input-field" value="V2025-001234" disabled>
            </div>

            <div class="form-row">
              <div class="input-group">
                <label class="input-label">Full Name</label>
                <input type="text" class="input-field" id="update-name" placeholder="John Doe">
              </div>
              <div class="input-group">
                <label class="input-label">Email</label>
                <input type="email" class="input-field" id="update-email" placeholder="john@example.com">
              </div>
            </div>

            <div class="form-row">
              <div class="input-group">
                <label class="input-label">Phone Number</label>
                <input type="tel" class="input-field" id="update-phone" placeholder="1234567890">
              </div>
              <div class="input-group">
                <label class="input-label">Age</label>
                <input type="number" class="input-field" id="update-age" placeholder="25" min="18">
              </div>
            </div>

            <div class="input-group">
              <label class="input-label">Address</label>
              <textarea class="input-field" id="update-address" placeholder="Enter your full address..."></textarea>
            </div>

            <div class="btn-group">
              <button class="btn btn-primary" onclick="updateVoterDetails()">
                <span>üíæ</span> Save Changes
              </button>
              <button class="btn btn-secondary" onclick="resetUpdateForm()">
                <span>‚Üª</span> Reset
              </button>
            </div>
          </div>

          <div id="update-result-container"></div>
        </div>
      </div>

    </main>
  </div>

  <script>
    // Navigation
    function showSection(sectionName) {
      // Hide all sections
      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.add('hidden');
      });

      // Remove active class from all nav items
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });

      // Show selected section
      document.getElementById(`${sectionName}-section`).classList.remove('hidden');

      // Add active class to clicked nav item
      event.target.closest('.nav-item').classList.add('active');

      // Close mobile menu
      if (window.innerWidth <= 1024) {
        document.getElementById('sidebar').classList.remove('active');
      }

      // Auto-load candidates when section opens
      if (sectionName === 'candidates') {
        getAllCandidates();
      }
    }

    // Mobile sidebar toggle
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('active');
    }

    // === GET VOTER DETAILS ===
    function getVoterDetails() {
      const voterId = document.getElementById('get-voter-id').value.trim();

      if (!voterId) {
        alert('Please enter your Voter ID');
        return;
      }

      const btn = event.target.closest('.btn');
      btn.classList.add('loading');

      setTimeout(() => {
        console.log('Fetching voter details:', voterId);
        // API: GET /api/voters/{voterId}

        const mockVoter = {
          id: voterId,
          name: 'John Doe',
          email: 'john@example.com',
          phone: '1234567890',
          age: 32,
          address: '123 Main St, City, State 12345',
          status: 'Active',
          registeredDate: '2025-01-15',
          votesC ast: 2
        };

        displayVoterDetails(mockVoter);
        btn.classList.remove('loading');
      }, 1500);
    }

    function displayVoterDetails(voter) {
      const container = document.getElementById('voter-details-container');
      
      container.innerHTML = `
        <div class="info-card">
          <div class="info-row">
            <span class="info-label">Voter ID</span>
            <span class="info-value">${voter.id}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Full Name</span>
            <span class="info-value">${voter.name}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Email</span>
            <span class="info-value">${voter.email}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Phone</span>
            <span class="info-value">${voter.phone}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Age</span>
            <span class="info-value">${voter.age} years</span>
          </div>
          <div class="info-row">
            <span class="info-label">Address</span>
            <span class="info-value">${voter.address}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Status</span>
            <span class="info-value"><span class="badge badge-success">${voter.status}</span></span>
          </div>
          <div class="info-row">
            <span class="info-label">Registered Date</span>
            <span class="info-value">${voter.registeredDate}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Votes Cast</span>
            <span class="info-value">${voter.votesCast}</span>
          </div>
        </div>
      `;
    }

    // === GET ALL CANDIDATES ===
    function getAllCandidates() {
      const container = document.getElementById('candidates-container');
      
      // Show loading
      container.innerHTML = '<div style="text-align:center; padding:40px; color:var(--text-muted);">Loading candidates...</div>';

      setTimeout(() => {
        console.log('Fetching all candidates');
        // API: GET /api/candidates

        const mockCandidates = [
          {
            id: 'C001',
            name: 'Alice Johnson',
            party: 'Democratic Party',
            position: 'President',
            bio: 'Experienced leader with 15 years in public service. Focus on education and healthcare reform.',
            votes: 1234
          },
          {
            id: 'C002',
            name: 'Bob Smith',
            party: 'Republican Party',
            position: 'President',
            bio: 'Business entrepreneur committed to economic growth and job creation. Strong defense advocate.',
            votes: 987
          },
          {
            id: 'C003',
            name: 'Carol Williams',
            party: 'Independent',
            position: 'President',
            bio: 'Community organizer focused on environmental protection and social justice initiatives.',
            votes: 456
          },
          {
            id: 'C004',
            name: 'David Brown',
            party: 'Green Party',
            position: 'President',
            bio: 'Environmental scientist dedicated to climate action and sustainable development policies.',
            votes: 234
          }
        ];

        displayCandidates(mockCandidates);
      }, 1500);
    }

    function displayCandidates(candidates) {
      const container = document.getElementById('candidates-container');
      
      container.innerHTML = candidates.map(c => `
        <div class="candidate-card">
          <div class="candidate-header">
            <div class="candidate-avatar">${c.name.charAt(0)}</div>
            <div class="candidate-info">
              <div class="candidate-name">${c.name}</div>
              <div class="candidate-party">${c.party}</div>
            </div>
          </div>
          <div class="candidate-details">
            <div style="margin-bottom:8px;">
              <span class="badge badge-primary">${c.position}</span>
              <span class="badge badge-info">ID: ${c.id}</span>
            </div>
            <div class="candidate-bio">${c.bio}</div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px;">
              <span style="font-size:12px; color:var(--text-muted);">Current Votes:</span>
              <span style="font-size:16px; font-weight:700; color:var(--accent-1);">${c.votes}</span>
            </div>
          </div>
        </div>
      `).join('');
    }

    // === UPDATE VOTER DETAILS ===
    function updateVoterDetails() {
      const name = document.getElementById('update-name').value.trim();
      const email = document.getElementById('update-email').value.trim();
      const phone = document.getElementById('update-phone').value.trim();
      const age = document.getElementById('update-age').value;
      const address = document.getElementById('update-address').value.trim();

      if (!name || !email || !phone || !age || !address) {
        alert('Please fill in all fields');
        return;
      }

      // Email validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        alert('Please enter a valid email address');
        return;
      }

      // Phone validation
      if (phone.length !== 10 || !/^\d+$/.test(phone)) {
        alert('Please enter a valid 10-digit phone number');
        return;
      }

      // Age validation
      if (age < 18) {
        alert('You must be at least 18 years old');
        return;
      }

      const btn = event.target.closest('.btn');
      btn.classList.add('loading');

      setTimeout(() => {
        console.log('Updating voter details:', { name, email, phone, age, address });
        // API: PUT /api/voters/{voterId}

        const container = document.getElementById('update-result-container');
        container.innerHTML = `
          <div class="alert alert-success">
            <span>‚úì</span>
            <span>Profile updated successfully! Changes will be reflected shortly.</span>
          </div>
        `;

        btn.classList.remove('loading');

        setTimeout(() => {
          container.innerHTML = '';
        }, 5000);
      }, 1500);
    }

    function resetUpdateForm() {
      document.getElementById('update-name').value = '';
      document.getElementById('update-email').value = '';
      document.getElementById('update-phone').value = '';
      document.getElementById('update-age').value = '';
      document.getElementById('update-address').value = '';
      document.getElementById('update-result-container').innerHTML = '';
    }

    // === CAST VOTE ===
    function castVote() {
      const contract = document.getElementById('vote-contract').value.trim();
      const candidateId = document.getElementById('vote-candidate').value;
      const confirm = document.getElementById('vote-confirm').value.trim();

      if (!contract || !candidateId || !confirm) {
        alert('Please fill in all fields');
        return;
      }

      if (confirm !== candidateId) {
        alert('Confirmation does not match selected candidate ID');
        return;
      }

      if (!window.confirm(`Are you sure you want to vote for candidate ${candidateId}? This action cannot be undone.`)) {
        return;
      }

      const btn = event.target.closest('.btn');
      btn.classList.add('loading');

      setTimeout(() => {
        console.log('Casting vote:', { contract, candidateId });
        // API: POST /api/vote with body: {contractAddress, candidateId, voterId}

        const container = document.getElementById('vote-result-container');
        container.innerHTML = `
          <div class="alert alert-success">
            <span>‚úì</span>
            <span>Your vote has been successfully recorded! Thank you for participating.</span>
          </div>
        `;

        btn.classList.remove('loading');
        clearVoteForm();

        setTimeout(() => {
          container.innerHTML = '';
        }, 7000);
      }, 2000);
    }

    function clearVoteForm() {
      document.getElementById('vote-contract').value = '';
      document.getElementById('vote-candidate').value = '';
      document.getElementById('vote-confirm').value = '';
    }

    // === GET VOTE RESULTS ===
    function getVoteResults() {
      const contract = document.getElementById('results-contract').value.trim();

      if (!contract) {
        alert('Please enter contract address');
        return;
      }

      const btn = event.target.closest('.btn');
      btn.classList.add('loading');

      setTimeout(() => {
        console.log('Fetching vote results:', { contract });
        // API: GET /api/votes/{contractAddress}

        const mockResults = [
          { candidateId: 'C001', name: 'Alice Johnson', party: 'Democratic', votes: 1234 },
          { candidateId: 'C002', name: 'Bob Smith', party: 'Republican', votes: 987 },
          { candidateId: 'C003', name: 'Carol Williams', party: 'Independent', votes: 456 },
          { candidateId: 'C004', name: 'David Brown', party: 'Green Party', votes: 234 }
        ];

        displayVoteResults(mockResults);
        btn.classList.remove('loading');
      }, 1500);
    }

    function displayVoteResults(results) {
      const container = document.getElementById('results-container');
      const totalVotes = results.reduce((sum, r) => sum + r.votes, 0);

      container.innerHTML = `
        <div class="results-table">
          <table>
            <thead>
              <tr>
                <th>Rank</th>
                <th>Candidate</th>
                <th>Party</th>
                <th>Votes</th>
                <th>Percentage</th>
                <th>Progress</th>
              </tr>
            </thead>
            <tbody>
              ${results.map((r, index) => {
                const percentage = ((r.votes / totalVotes) * 100).toFixed(1);
                return `
                  <tr>
                    <td><strong>#${index + 1}</strong></td>
                    <td><strong>${r.name}</strong></td>
                    <td>${r.party}</td>
                    <td><strong style="color:var(--accent-1)">${r.votes.toLocaleString()}</strong></td>
                    <td><span class="badge badge-info">${percentage}%</span></td>
                    <td>
                      <div class="vote-progress">
                        <div class="vote-progress-bar" style="width:${percentage}%"></div>
                      </div>
                    </td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        </div>
        <div class="info-card">
          <div class="info-row">
            <span class="info-label">Total Votes Cast</span>
            <span class="info-value" style="font-size:20px; color:var(--accent-1)">${totalVotes.toLocaleString()}</span>
          </div>
          <div class="info-row">
            <span class="info-label">Leading Candidate</span>
            <span class="info-value">${results[0].name} (${results[0].party})</span>
          </div>
          <div class="info-row">
            <span class="info-label">Election Status</span>
            <span class="info-value"><span class="badge badge-success">In Progress</span></span>
          </div>
        </div>
      `;
    }

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', (e) => {
      if (window.innerWidth <= 1024) {
        const sidebar = document.getElementById('sidebar');
        const toggle = document.querySelector('.mobile-menu-toggle');
        
        if (!sidebar.contains(e.target) && !toggle.contains(e.target)) {
          sidebar.classList.remove('active');
        }
      }
    });

    // Auto-load candidates on page load
    window.addEventListener('load', () => {
      // Simulate auto-loading candidates after a short delay
      setTimeout(() => {
        if (!document.getElementById('candidates-section').classList.contains('hidden')) {
          getAllCandidates();
        }
      }, 500);
    });
  </script>
</body>
</html>
